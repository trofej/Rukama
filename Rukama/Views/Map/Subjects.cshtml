@model IEnumerable<Rukama.Models.Subject>
@{
    ViewData["Title"] = "Interactive map";
    Layout = "~/Views/Map/_MapLayout.cshtml";
}

    
    
    <!DOCTYPE html>
    <html>
    <head>
        <title></title>
        <meta charset="utf-8" />

        <!-- Reference to the Bing Maps SDK -->
        <script type='text/javascript'
                src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=Am60p6qXOEAGu07U49eslvfRG8MMPRyOHMLUkX4lIKIGeEo7-es4b73eRwCLaXni' 
                async defer></script>
    
        <script type='text/javascript'>
        function GetMap()
        {
            var map = new Microsoft.Maps.Map('#myMap');

            //Add your post map load code here.

            // Create the infobox for the pushpin  
            var infobox = null;
            

            //declare addMarker function  
            function addMarker(Latitude, Longitude, SubjectID, SubjectName, LegalForm, Specialization)  
            {  
                var marker = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(Latitude, Longitude), {
                    icon: '/Images/Icons/blacksmithing.png'});  
  
                infobox = new Microsoft.Maps.Infobox(marker.getLocation(), {  
                    visible : false     
                });  
  
                marker.metadata = {  
                    id: SubjectID,  
                    title: SubjectName,
                    form: LegalForm,
                    spec: Specialization
                };  
  
                Microsoft.Maps.Events.addHandler(marker, 'mouseout', hideInfobox);  
                Microsoft.Maps.Events.addHandler(marker, 'mouseover', showInfobox);  
  
                infobox.setMap(map);  
                map.entities.push(marker);  
                marker.setOptions({ enableHoverStyle: true });  
            };  
  
            function showInfobox(e) {  
                if (e.target.metadata) {  
                    infobox.setOptions({  
                        location: e.target.getLocation(),  
                        title: e.target.metadata.title,
                        description: e.target.metadata.spec,
                        visible: true  
                    });  
                }  
            }  
  
            function hideInfobox(e) {  
                infobox.setOptions({ visible: false });  
            }  
  
            //add markers to map  
            @if (Model != null)  
            {  
                @foreach (var item in Model)  
                {  
                    @:addMarker(@item.Latitude, @item.Longitude, @item.SubjectID, '@item.SubjectName', '@item.LegalForm', '@item.Specialization');  
                }  
            }  
            }
        </script>
    </head>
    <body>
        <div id="myMap"></div>
    </body>
    </html>
